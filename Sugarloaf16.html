<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>PAPA RON'S PREMIUM POS</title>
    <style>
        :root {
            --primary: #d4a373;
            --bg: #000000;
            --surface: #121212;
            --surface-light: #1e1e1e;
            --accent: #44ff44;
            --danger: #ff4444;
            --warning: #ff9800;
            --gold-grad: linear-gradient(145deg, #d4a373, #b38b59, #8a6d4b);
        }

        body { 
            font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; 
            background: var(--bg); 
            color: #fff; 
            margin: 0; 
            padding: 8px; 
            overflow-x: hidden;
        }

        /* LOGIN OVERLAY */
        #login-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: var(--bg); z-index: 9999; display: flex;
            flex-direction: column; align-items: center; justify-content: center;
        }
        .login-box { background: var(--surface); padding: 30px; border-radius: 15px; border: 2px solid var(--primary); width: 80%; max-width: 300px; text-align: center; }
        .pin-display { font-size: 2.5rem; letter-spacing: 12px; margin-bottom: 25px; color: var(--primary); font-weight: 900; background: #000; padding: 10px; border-radius: 8px; min-height: 50px; }
        
        h1 { text-align: center; color: var(--primary); font-size: 1.4rem; letter-spacing: 2px; text-transform: uppercase; margin: 10px 0; font-weight: 900; }
        h3 { color: var(--primary); margin: 0; font-weight: 800; text-transform: uppercase; font-size: 0.9rem; }

        input, button, select { 
            font-size: 0.9rem; 
            padding: 12px; 
            margin: 4px 0; 
            width: 100%; 
            border-radius: 6px; 
            box-sizing: border-box; 
            border: 1px solid #333; 
            font-weight: 800;
        }

        button { 
            background: var(--gold-grad) !important; 
            color: #000 !important; 
            border: none !important; 
            cursor: pointer; 
            text-transform: uppercase; 
            font-weight: 900; 
        }
        
        button:active { transform: scale(0.96); opacity: 0.8; }
        
        .grid-main { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; }
        .tab-content { display: none; margin-top: 10px; }
        .active-tab { display: block; }
        
        .category-grid { 
            display: grid; 
            grid-template-columns: repeat(auto-fill, minmax(95px, 1fr)); 
            gap: 6px; 
            background: var(--surface); 
            padding: 8px; 
            border-radius: 10px; 
        }

        .product-btn { 
            position: relative; 
            min-height: 70px; 
            font-size: 0.75rem; 
            color: #000 !important; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            text-align: center; 
            border-radius: 6px; 
            font-weight: 900;
            padding: 4px;
            background: var(--gold-grad); 
            border-bottom: 3px solid #8a6d4b;
        }

        #trans-tabs { display: flex; gap: 4px; overflow-x: auto; padding: 4px 0; }
        .tab-btn { width: auto; padding: 8px 16px; background: #222 !important; color: #777 !important; border: 1px solid #333 !important; }
        .tab-btn.active { background: var(--gold-grad) !important; color: #000 !important; }

        #cart-list { background: var(--surface); border-radius: 8px; padding: 8px; margin: 8px 0; max-height: 180px; overflow-y: auto; border: 1px solid #222; }
        .cart-row { display: flex; justify-content: space-between; border-bottom: 1px solid #222; padding: 8px 0; align-items: center; font-weight: 700; }
        #total-view { font-size: 2.5rem; color: var(--accent); text-align: center; margin: 5px 0; font-family: monospace; font-weight: 900; }

        .stock-row { display: grid; grid-template-columns: 1.5fr 1fr 1fr; align-items: center; background: var(--surface); margin-bottom: 4px; padding: 10px; border-radius: 6px; border: 1px solid #222; font-size: 0.85rem; }
        
        .modal { position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: #111; padding: 20px; border-radius: 12px; width: 85%; max-width: 350px; z-index: 1000; border: 2px solid var(--primary); display: none; }
    </style>
</head>
<body>

    <div id="login-overlay">
        <div class="login-box">
            <h1>STAFF LOGIN</h1>
            <div id="pin-screen" class="pin-display">****</div>
            <div class="grid-main" style="grid-template-columns: 1fr 1fr 1fr;">
                <button onclick="pressPin(1)">1</button><button onclick="pressPin(2)">2</button><button onclick="pressPin(3)">3</button>
                <button onclick="pressPin(4)">4</button><button onclick="pressPin(5)">5</button><button onclick="pressPin(6)">6</button>
                <button onclick="pressPin(7)">7</button><button onclick="pressPin(8)">8</button><button onclick="pressPin(9)">9</button>
                <button onclick="clearPin()" style="background:var(--danger)!important; color:#fff!important;">CLR</button>
                <button onclick="pressPin(0)">0</button>
                <button onclick="checkPin()" style="background:var(--accent)!important; color:#000!important;">GO</button>
            </div>
        </div>
    </div>

    <div id="app-shell" style="display:none;">
        <div style="display: flex; justify-content: space-between; align-items: center;">
            <h1 style="margin: 0;">Papa Ron's</h1>
            <div style="display: flex; gap: 5px;">
                <button onclick="printUserCashUp()" style="width: auto; padding: 5px 10px; background: var(--warning)!important; color: #000!important;">CASH UP</button>
                <button onclick="logout()" style="width: auto; padding: 5px 10px; background: #333!important; color: #fff!important;">LOCK</button>
            </div>
        </div>
        <p id="user-tag" style="color: var(--primary); text-align: center; font-weight: 900; margin: 5px 0;"></p>

        <div class="grid-main">
            <button onclick="switchTab('pos-tab')">Sales</button>
            <button onclick="switchTab('stock-tab')">Stock View</button>
            <button onclick="switchTab('mgr-tab')" class="mgr-only">Admin</button>
        </div>

        <div id="pos-tab" class="tab-content active-tab">
            <div id="trans-tabs"></div>
            <button onclick="createNewTransaction()" style="padding: 12px; margin: 5px 0;">+ NEW TABLE</button>
            <div class="grid-main">
                <div class="category-grid" id="foodGrid"></div>
                <div class="category-grid" id="drinkGrid"></div>
            </div>
            <div id="cart-list"></div>
            <div id="total-view">R 0.00</div>
            <div class="grid-main">
                <button onclick="openTender()" style="height:60px;">CASH</button>
                <button onclick="finalizeSale('Card')" style="height:60px;">CARD</button>
                <button onclick="printKitchenSlip()">Kitchen Slip</button>
                <button onclick="deleteCurrentTransaction()" style="background:transparent !important; border:1px solid var(--danger) !important; color:var(--danger) !important;">Void</button>
            </div>
        </div>

        <div id="stock-tab" class="tab-content">
            <h3 style="padding: 10px 0;">Current Inventory</h3>
            <div id="inventory-list"></div>
        </div>

        <div id="mgr-tab" class="tab-content">
            <div style="background:var(--surface); padding:15px; border-radius:10px;">
                <h3>Add New Menu Item</h3>
                <input type="text" id="m-name" placeholder="ITEM NAME">
                <input type="number" id="m-price" placeholder="PRICE">
                <select id="m-cat"><option value="food">Food</option><option value="drink">Drink</option></select>
                <button onclick="saveNewProduct()">SAVE ITEM</button>
                <hr style="border: 0; border-top: 1px solid #333; margin: 20px 0;">
                <button onclick="generateFullReport()">Full Z-Report (Manager)</button>
            </div>
        </div>
    </div>

    <div id="tender-modal" class="modal">
        <h1 id="cash-total-needed" style="text-align:center; color:var(--accent);"></h1>
        <input type="number" id="cash-amt" placeholder="Amount Received" oninput="calculateChange()">
        <h2 id="change-due" style="text-align:center;">Change: R0.00</h2>
        <button onclick="finalizeSale('Cash')" style="height: 50px;">COMPLETE</button>
        <button onclick="closeModal()" style="margin-top:8px;">Back</button>
    </div>

    <script>
        let currentUser = "";
        let currentRole = "";
        const STAFF = {
            "1212": "Ron",
            "1234": "Staff 1",
            "5678": "Staff 2",
            "0000": "Admin"
        };

        function pressPin(n) { if(currentUser.length < 4) { currentUser += n; document.getElementById('pin-screen').textContent = "*".repeat(currentUser.length); } }
        function clearPin() { currentUser = ""; document.getElementById('pin-screen').textContent = "****"; }
        
        function checkPin() {
            const name = STAFF[currentUser];
            if(name) {
                currentRole = (currentUser === "0000") ? "manager" : "staff";
                document.getElementById('user-tag').textContent = "LOGGED IN: " + name.toUpperCase();
                document.getElementById('login-overlay').style.display = 'none';
                document.getElementById('app-shell').style.display = 'block';
                document.querySelectorAll('.mgr-only').forEach(el => el.style.display = (currentRole === 'manager' ? 'block' : 'none'));
                renderPOS();
            } else { alert("WRONG PIN"); clearPin(); }
        }

        function logout() { currentUser = ""; location.reload(); }

        let inventory = JSON.parse(localStorage.getItem('pos_inv')) || {};
        let transactions = JSON.parse(localStorage.getItem('pos_trans')) || [];
        if (transactions.filter(t => t.status === 'active').length === 0) {
            transactions.push({id: 1, items: [], status: 'active', user: '', date: new Date().getTime()});
        }
        let currentTransIdx = transactions.findIndex(t => t.status === 'active');

        function save() {
            localStorage.setItem('pos_inv', JSON.stringify(inventory));
            localStorage.setItem('pos_trans', JSON.stringify(transactions));
        }

        function renderPOS() {
            const f = document.getElementById('foodGrid'); const d = document.getElementById('drinkGrid');
            f.innerHTML = ''; d.innerHTML = '';
            Object.keys(inventory).forEach(key => {
                const btn = document.createElement('div');
                btn.className = 'product-btn';
                btn.innerHTML = `<div onclick="addToCart('${key}')" style="width:100%"><b>${inventory[key].name}</b><br>R${inventory[key].price.toFixed(2)}</div>`;
                inventory[key].category === 'food' ? f.appendChild(btn) : d.appendChild(btn);
            });
            const tTabs = document.getElementById('trans-tabs'); tTabs.innerHTML = '';
            transactions.forEach((t, i) => {
                if(t.status !== 'active') return;
                const btn = document.createElement('button');
                btn.className = `tab-btn ${i === currentTransIdx ? 'active' : ''}`;
                btn.textContent = `Table ${t.id}`;
                btn.onclick = () => { currentTransIdx = i; renderPOS(); };
                tTabs.appendChild(btn);
            });
            updateCartUI();
        }

        function addToCart(key) {
            transactions[currentTransIdx].items.push({...inventory[key], code: key});
            save(); updateCartUI();
        }

        function updateCartUI() {
            const list = document.getElementById('cart-list'); list.innerHTML = '';
            let total = 0;
            transactions[currentTransIdx].items.forEach((it, i) => {
                total += it.price;
                list.innerHTML += `<div class="cart-row"><span>${it.name}</span><span>R${it.price.toFixed(2)} <button onclick="removeFromCart(${i})" style="background:var(--danger)!important; color:#fff!important; width:30px; padding:2px;">-</button></span></div>`;
            });
            document.getElementById('total-view').textContent = `R ${total.toFixed(2)}`;
        }

        function removeFromCart(i) { transactions[currentTransIdx].items.splice(i, 1); save(); updateCartUI(); }

        function finalizeSale(method) {
            const t = transactions[currentTransIdx];
            if (t.items.length === 0) return;
            t.total = t.items.reduce((s, i) => s + i.price, 0);
            t.method = method; t.status = 'paid'; t.userPin = currentUser; // Track who sold it
            t.userName = STAFF[currentUser];
            t.date = new Date().getTime();
            save(); createNewTransaction(); closeModal();
            alert("Sale Saved Under " + STAFF[currentUser]);
        }

        function printUserCashUp() {
            const name = STAFF[currentUser];
            const sales = transactions.filter(t => t.status === 'paid' && t.userPin === currentUser);
            let total = 0;
            let cash = 0;
            let card = 0;
            sales.forEach(s => {
                total += s.total;
                if(s.method === 'Cash') cash += s.total;
                else card += s.total;
            });

            let win = window.open('', '', 'width=300,height=400');
            let content = `--- CASH UP ---\nUSER: ${name.toUpperCase()}\nDATE: ${new Date().toLocaleDateString()}\n----------------\nCASH:  R${cash.toFixed(2)}\nCARD:  R${card.toFixed(2)}\n----------------\nTOTAL: R${total.toFixed(2)}\n----------------`;
            win.document.write(`<pre style="font-family:monospace; font-size:12pt;">${content}</pre>`);
            win.document.close(); win.print();
        }

        function switchTab(id) {
            document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active-tab'));
            document.getElementById(id).classList.add('active-tab');
            if(id === 'stock-tab') renderStock();
        }

        function renderStock() {
            const list = document.getElementById('inventory-list'); list.innerHTML = '';
            Object.keys(inventory).forEach(key => {
                const itm = inventory[key];
                list.innerHTML += `<div class="stock-row"><b>${itm.name}</b> <span>R${itm.price}</span> <span>[ ${itm.category} ]</span></div>`;
            });
        }

        function saveNewProduct() {
            const name = document.getElementById('m-name').value.toUpperCase();
            const price = parseFloat(document.getElementById('m-price').value);
            const cat = document.getElementById('m-cat').value;
            if(!name || !price) return;
            inventory["P_"+Date.now()] = { name, price, category: cat };
            save(); alert("Item Added");
        }

        function createNewTransaction() {
            transactions.push({id: transactions.length + 1, items: [], status:'active', user: STAFF[currentUser], date: new Date().getTime()});
            currentTransIdx = transactions.length - 1; renderPOS();
        }

        function openTender() {
            const total = transactions[currentTransIdx].items.reduce((s, i) => s + i.price, 0);
            document.getElementById('cash-total-needed').textContent = `R${total.toFixed(2)}`;
            document.getElementById('tender-modal').style.display = 'block';
        }

        function calculateChange() {
            const total = transactions[currentTransIdx].items.reduce((s, i) => s + i.price, 0);
            const cash = parseFloat(document.getElementById('cash-amt').value) || 0;
            document.getElementById('change-due').textContent = `Change: R${(cash - total).toFixed(2)}`;
        }

        function closeModal() { document.querySelectorAll('.modal').forEach(m => m.style.display='none'); }
        function deleteCurrentTransaction() { if(confirm("Void current table?")) { transactions[currentTransIdx].items = []; save(); updateCartUI(); } }
        
        window.onload = () => { renderPOS(); };
    </script>
</body>
</html>
