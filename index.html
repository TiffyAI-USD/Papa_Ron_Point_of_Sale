<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PAPA RON'S COFFEE BAY POS</title>
    <style>
        body { font-family: Arial, sans-serif; background: #000; color: #fff; margin: 0; padding: 10px; }
        h1 { text-align: center; color: #d4a373; font-size: 2.5rem; margin: 20px 0; }
        input, button { font-size: 1.8rem; padding: 15px; margin: 10px 0; width: 100%; border-radius: 10px; box-sizing: border-box; }
        button { background: #d4a373; color: #000; border: none; cursor: pointer; }
        #items { list-style: none; padding: 0; max-height: 35vh; overflow-y: auto; }
        li { background: #111; padding: 15px; margin: 10px 0; border-radius: 10px; font-size: 1.6rem; }
        #total { font-size: 2.5rem; text-align: center; margin: 20px 0; color: #d4a373; }
        #login, #stockIn, #inventoryView, #transactionsView { text-align: center; margin-top: 50px; }
        #pos, #inventoryView, #multiplierPopup, #tenderPopup { display: none; }
        .stock-info { font-size: 1.4rem; color: #aaa; margin: 15px 0; text-align: center; }
        .low-stock { color: #ff4444; font-weight: bold; }
        #inventoryList { list-style: none; padding: 0; max-height: 70vh; overflow-y: auto; }
        #inventoryList li { background: #111; padding: 12px; margin: 8px 0; border-radius: 8px; font-size: 1.4rem; }
        .in-stock { color: #44ff44; }
        .low-stock-item { color: #ff4444; }
        #multiplierPopup, #tenderPopup { 
            position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); 
            background: #111; padding: 20px; border-radius: 20px; width: 90%; max-width: 400px; 
            z-index: 1000; box-shadow: 0 0 20px rgba(212,163,115,0.5); 
        }
        #multiplierPopup input, #tenderPopup input { margin: 15px 0; text-align: center; width: 100%; }
        #tenderResult { font-size: 2rem; color: #44ff44; text-align: center; margin: 10px 0; }
        .active-trans { color: #44ff44; font-weight: bold; }
        .paid-trans { color: #d4a373; font-weight: bold; }
        .transaction-btn { margin: 5px; padding: 10px; font-size: 1.4rem; }
        #stockInputRow { display: flex; gap: 10px; }
        #stockInputRow input { flex: 1; }
        #stockInputRow button { flex: 0 0 auto; width: auto; }
        .print-btn { background: #ff9800; color: white; font-weight: bold; margin: 15px 0; padding: 18px; font-size: 1.8rem; }

        /* Quick buttons */
        #quickButtons { margin: 15px 0; }
        .category-section { width: 48%; }
        .category-title { text-align: center; color: #d4a373; margin-bottom: 8px; font-size: 1.6rem; }
        .category-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; max-height: 45vh; overflow-y: auto; padding-right: 5px; }
        .product-btn { font-size: 1.2rem; padding: 12px; color: white; border-radius: 8px; cursor: pointer; text-align: center; border: none; }
        .food-btn { background: #8b5a2b; }
        .drink-btn { background: #1e88e5; }
    </style>
</head>
<body>
    <h1>PAPA RON'S COFFEE BAY</h1>

    <div id="login">
        <h2>Enter PIN to Start Sale</h2>
        <input type="password" id="pin" placeholder="Your PIN" autofocus />
        <button onclick="login()">Login for Sale</button>
        <button onclick="stockInMode()">Replenish Stock</button>
    </div>

    <div id="pos">
        <button onclick="logout()">Logout</button>
        <button onclick="showInventory()">View Inventory</button>
        <button onclick="showZReading()">Z Reading (Daily Report)</button>
        <button onclick="showTransactions()">Manage Transactions</button>

        <div id="quickButtons">
            <div style="display: flex; justify-content: space-between; gap: 15px;">
                <div class="category-section">
                    <div class="category-title">Food</div>
                    <div id="foodGrid" class="category-grid"></div>
                </div>
                <div class="category-section">
                    <div class="category-title">Drinks</div>
                    <div id="drinkGrid" class="category-grid"></div>
                </div>
            </div>
        </div>

        <input type="text" id="barcode" placeholder="Scan or type barcode" autofocus />
        <button onclick="addItem()">Add to Sale</button>
        <button onclick="clearCart()">Clear Current Transaction</button>
        <button onclick="printPreview()">Print Preview (Kitchen & Bar Tabs)</button>
        <button onclick="payCash()">Cash Payment</button>
        <button onclick="payCard()">Card Payment</button>
        <button class="print-btn" onclick="printLastReceipt()" style="display:none;" id="printReceiptBtn">Print Receipt & Close Sale</button>

        <h3>Current Transaction: <span id="currentTransNum">1</span> <span id="transStatus"></span></h3>
        <ul id="items"></ul>
        <div id="total">Total: R0.00</div>
        <div id="stockStatus" class="stock-info"></div>
    </div>

    <div id="stockIn">
        <h2>Stock In Mode</h2>
        <button onclick="logout()">Back to Login</button>
        <div id="stockInputRow">
            <input type="text" id="stockBarcode" placeholder="Scan incoming stock" autofocus />
            <button onclick="processStockInput()">Add Stock</button>
        </div>
        <div id="stockInStatus" class="stock-info"></div>
    </div>

    <div id="inventoryView">
        <h2>Current Inventory</h2>
        <button onclick="backToPOS()">Back to Sale</button>
        <ul id="inventoryList"></ul>
    </div>

    <div id="transactionsView">
        <h2>Transactions</h2>
        <button onclick="backToPOS()">Back to Sale</button>
        <div id="transList"></div>
    </div>

    <div id="multiplierPopup">
        <h2 id="popupItemName"></h2>
        <p>Enter quantity (leave blank for 1 single)</p>
        <input type="number" id="packsInput" placeholder="Packs (×6)" min="0" />
        <input type="number" id="casesInput" placeholder="Cases (×24)" min="0" />
        <button onclick="confirmMultiplier()">Confirm</button>
        <button onclick="cancelMultiplier()">Cancel (add 1 single)</button>
    </div>

    <div id="tenderPopup">
        <h2>Cash Tender</h2>
        <p>Total: R<span id="tenderTotal">0.00</span></p>
        <input type="number" id="tenderAmount" placeholder="Amount Tendered (e.g. 100)" min="0" step="0.01" autofocus />
        <div id="tenderResult"></div>
        <button onclick="confirmTender()">Confirm Payment</button>
        <button onclick="cancelTender()">Cancel</button>
    </div>

    <audio id="clickSound" src="https://tiffyai-usd.github.io/Papa_Ron_Point_of_Sale/click.wav" preload="auto"></audio>
    <audio id="eatSound" src="https://tiffyai-usd.github.io/Papa_Ron_Point_of_Sale/eat.wav" preload="auto"></audio>
    <audio id="sparkleSound" src="https://tiffyai-usd.github.io/Papa_Ron_Point_of_Sale/sparcle.wav" preload="auto"></audio>

    <script>
        // Sounds
        function playClick() { document.getElementById("clickSound").play().catch(() => {}); }
        function playEat() { document.getElementById("eatSound").play().catch(() => {}); }
        function playSparkle() { document.getElementById("sparkleSound").play().catch(() => {}); }

        document.querySelectorAll('button').forEach(btn => btn.addEventListener('click', playClick));

        const STAFF = {
            "1234": "Staff 1",
            "5678": "Staff 2",
            "9012": "Staff 3",
            "3456": "Manager"
        };

        let currentPIN = "";
        let currentStaffName = "";
        let lastReceiptContent = "";
        let pendingStockCode = "";

        let inventory = JSON.parse(localStorage.getItem('posInventory')) || {
            "1001": { name: "SOMETHING MEATY PIZZA", price: 135, stock: 0, sold: 0, category: "food" },
            "1002": { name: "HAWAIIAN PIZZA", price: 135, stock: 0, sold: 0, category: "food" },
            "1003": { name: "FLAMING SPARE RIB PIZZA", price: 150, stock: 0, sold: 0, category: "food" },
            "1004": { name: "CHEESE BURGER", price: 120, stock: 0, sold: 0, category: "food" },
            "1005": { name: "CHEESY STRIPS (5)", price: 50, stock: 0, sold: 0, category: "food" },
            "1006": { name: "BOERIE ROLL", price: 50, stock: 0, sold: 0, category: "food" },
            "1007": { name: "RUMP STEAK", price: 160, stock: 0, sold: 0, category: "food" },
            "1008": { name: "RIB RACK", price: 200, stock: 0, sold: 0, category: "food" },
            "1009": { name: "SCHNITZEL", price: 120, stock: 0, sold: 0, category: "food" },
            "1010": { name: "PREGO ROLL", price: 50, stock: 0, sold: 0, category: "food" },
            "1011": { name: "MUNCHIE PLATTER", price: 350, stock: 0, sold: 0, category: "food" },
            "1012": { name: "CHEESY POPS", price: 50, stock: 0, sold: 0, category: "food" },
            "1013": { name: "CHICKEN PERI NACHO", price: 160, stock: 0, sold: 0, category: "food" },
            "1014": { name: "WINGLETS 5", price: 60, stock: 0, sold: 0, category: "food" },
            "1015": { name: "WINGLETS 10", price: 100, stock: 0, sold: 0, category: "food" },
            "1016": { name: "PLATTER FOR 2", price: 350, stock: 0, sold: 0, category: "food" },
            "1017": { name: "BREAKFAST", price: 80, stock: 0, sold: 0, category: "food" },
            "1018": { name: "SIDE CHIPS", price: 20, stock: 0, sold: 0, category: "food" },
            "1019": { name: "SIDE SALAD", price: 20, stock: 0, sold: 0, category: "food" },
            "1020": { name: "GREEK SALAD", price: 20, stock: 0, sold: 0, category: "food" },
            "1021": { name: "COCA COLA", price: 20, stock: 0, sold: 0, category: "drink" },
            "1022": { name: "SPRITE", price: 20, stock: 0, sold: 0, category: "drink" },
            "1023": { name: "FANTA", price: 20, stock: 0, sold: 0, category: "drink" },
            "1024": { name: "WATER", price: 10, stock: 0, sold: 0, category: "drink" },
            "1025": { name: "ENERGY DRINK", price: 25, stock: 0, sold: 0, category: "drink" },
            "1026": { name: "COFFEE", price: 25, stock: 0, sold: 0, category: "drink" },
            "1027": { name: "TEA", price: 15, stock: 0, sold: 0, category: "drink" },
            "1028": { name: "MILKSHAKE", price: 35, stock: 0, sold: 0, category: "drink" },
            "1029": { name: "ICED COFFEE", price: 30, stock: 0, sold: 0, category: "drink" },
            "1030": { name: "CAPPUCCINO", price: 30, stock: 0, sold: 0, category: "drink" }
        };

        let currentTransaction = [];
        let transactions = JSON.parse(localStorage.getItem('posTransactions')) || [];
        let currentTransNum = transactions.length + 1;

        function login() {
            const pin = document.getElementById('pin').value;
            if (STAFF[pin]) {
                currentPIN = pin;
                currentStaffName = STAFF[pin];
                document.getElementById('login').style.display = 'none';
                document.getElementById('pos').style.display = 'block';
                loadQuickButtons();
            } else {
                alert('Invalid PIN');
            }
        }

        function logout() {
            currentPIN = "";
            currentStaffName = "";
            document.getElementById('pos').style.display = 'none';
            document.getElementById('login').style.display = 'block';
            clearCart();
        }

        function stockInMode() {
            document.getElementById('login').style.display = 'none';
            document.getElementById('stockIn').style.display = 'block';
        }

        function processStockInput() {
            const code = document.getElementById('stockBarcode').value;
            if (inventory[code]) {
                inventory[code].stock += 1;
                localStorage.setItem('posInventory', JSON.stringify(inventory));
                document.getElementById('stockInStatus').textContent = `Added 1 unit of ${inventory[code].name}. Current stock: ${inventory[code].stock}`;
            } else {
                document.getElementById('stockInStatus').textContent = `Barcode ${code} not recognized`;
            }
            document.getElementById('stockBarcode').value = '';
        }

        function addItem() {
            const code = document.getElementById('barcode').value;
            if (!code) return;
            if (inventory[code]) {
                if (inventory[code].stock > 0) {
                    currentTransaction.push({ code: code, name: inventory[code].name, price: inventory[code].price });
                    inventory[code].stock -= 1;
                    updateCart();
                } else {
                    alert(`${inventory[code].name} is out of stock`);
                }
            } else {
                alert(`Item ${code} not found`);
            }
            document.getElementById('barcode').value = '';
        }

        function clearCart() {
            currentTransaction = [];
            updateCart();
        }

        function updateCart() {
            const itemsEl = document.getElementById('items');
            itemsEl.innerHTML = '';
            let total = 0;
            currentTransaction.forEach(item => {
                const li = document.createElement('li');
                li.textContent = `${item.name} - R${item.price.toFixed(2)}`;
                itemsEl.appendChild(li);
                total += item.price;
            });
            document.getElementById('total').textContent = `Total: R${total.toFixed(2)}`;
        }

        function confirmTender() {
            const tenderAmt = parseFloat(document.getElementById('tenderAmount').value);
            let total = currentTransaction.reduce((sum, item) => sum + item.price, 0);
            if (tenderAmt >= total) {
                const change = tenderAmt - total;
                document.getElementById('tenderResult').textContent = `Change: R${change.toFixed(2)}`;
                saveTransaction('cash');
                currentTransaction = [];
                updateCart();
                document.getElementById('tenderPopup').style.display = 'none';
            } else {
                alert('Tendered amount is less than total');
            }
        }

        function payCash() {
            const total = currentTransaction.reduce((sum, item) => sum + item.price, 0);
            document.getElementById('tenderTotal').textContent = total.toFixed(2);
            document.getElementById('tenderPopup').style.display = 'block';
            document.getElementById('tenderAmount').focus();
        }

        function payCard() {
            alert('Card payment processed');
            saveTransaction('card');
            currentTransaction = [];
            updateCart();
        }

        function saveTransaction(method) {
            const trans = {
                num: currentTransNum,
                staff: currentStaffName,
                items: [...currentTransaction],
                method: method,
                time: new Date().toLocaleString()
            };
            transactions.push(trans);
            localStorage.setItem('posTransactions', JSON.stringify(transactions));
            currentTransNum++;
        }

        function showInventory() {
            document.getElementById('pos').style.display = 'none';
            document.getElementById('inventoryView').style.display = 'block';
            const invList = document.getElementById('inventoryList');
            invList.innerHTML = '';
            Object.keys(inventory).forEach(code => {
                const li = document.createElement('li');
                li.textContent = `${inventory[code].name} - Stock: ${inventory[code].stock}`;
                if (inventory[code].stock <= 3) li.classList.add('low-stock-item');
                else li.classList.add('in-stock');
                invList.appendChild(li);
            });
        }

        function backToPOS() {
            document.getElementById('inventoryView').style.display = 'none';
            document.getElementById('transactionsView').style.display = 'none';
            document.getElementById('pos').style.display = 'block';
        }

        function loadQuickButtons() {
            const foodGrid = document.getElementById('foodGrid');
            const drinkGrid = document.getElementById('drinkGrid');
            foodGrid.innerHTML = '';
            drinkGrid.innerHTML = '';
            Object.keys(inventory).forEach(code => {
                const btn = document.createElement('button');
                btn.textContent = inventory[code].name;
                btn.classList.add('product-btn');
                btn.onclick = () => { document.getElementById('barcode').value = code; addItem(); };
                if (inventory[code].category === 'food') btn.classList.add('food-btn');
                else btn.classList.add('drink-btn');
                if (inventory[code].category === 'food') foodGrid.appendChild(btn);
                else drinkGrid.appendChild(btn);
            });
        }

        function showTransactions() {
            document.getElementById('pos').style.display = 'none';
            document.getElementById('transactionsView').style.display = 'block';
            const transDiv = document.getElementById('transList');
            transDiv.innerHTML = '';
            transactions.forEach(t => {
                const div = document.createElement('div');
                div.innerHTML = `<strong>Transaction #${t.num} by ${t.staff}</strong> - ${t.time} - Method: ${t.method}`;
                t.items.forEach(i => { div.innerHTML += `<div>${i.name} - R${i.price.toFixed(2)}</div>`; });
                transDiv.appendChild(div);
            });
        }

        function printLastReceipt() {
            let receipt = 'Receipt\n\n';
            currentTransaction.forEach(item => {
                receipt += `${item.name} - R${item.price.toFixed(2)}\n`;
            });
            receipt += `Total: R${currentTransaction.reduce((sum, i) => sum + i.price, 0).toFixed(2)}\n`;
            alert(receipt);
            lastReceiptContent = receipt;
        }

    </script>
</body>
</html>
