<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UNIVERSAL POS & RECIPE MANAGER</title>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: #000; color: #fff; margin: 0; padding: 10px; }
        h1 { text-align: center; color: #d4a373; margin: 10px 0; }
        input, button, select { font-size: 1.2rem; padding: 12px; margin: 5px 0; width: 100%; border-radius: 8px; box-sizing: border-box; border: 1px solid #333; }
        button { background: #d4a373; color: #000; cursor: pointer; font-weight: bold; transition: 0.2s; }
        button:active { transform: scale(0.98); }
        
        /* Layout */
        .main-container { display: flex; flex-direction: column; gap: 10px; max-width: 1200px; margin: auto; }
        .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        
        /* Product Buttons */
        .category-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(140px, 1fr)); gap: 10px; max-height: 40vh; overflow-y: auto; padding: 10px; background: #111; border-radius: 10px; }
        .product-btn { position: relative; min-height: 80px; font-size: 1rem; color: white; border: none; display: flex; flex-direction: column; justify-content: center; align-items: center; text-align: center; }
        .food-btn { background: #5d4037; }
        .drink-btn { background: #1565c0; }
        .price-tag { font-size: 0.8rem; opacity: 0.8; }
        
        /* Delete X on buttons */
        .btn-del-x { position: absolute; top: 2px; right: 2px; background: rgba(255,0,0,0.7); color: white; border-radius: 50%; width: 24px; height: 24px; font-size: 0.7rem; display: flex; align-items: center; justify-content: center; z-index: 5; }

        /* Cart & Total */
        #items { list-style: none; padding: 0; max-height: 25vh; overflow-y: auto; background: #111; border-radius: 10px; }
        .cart-item { display: flex; justify-content: space-between; align-items: center; padding: 10px; border-bottom: 1px solid #222; }
        #total-display { font-size: 2.5rem; text-align: center; color: #44ff44; margin: 10px 0; }

        /* Tabs */
        .tab-content { display: none; }
        .active-tab { display: block; }
        
        /* Recipe Builder */
        .recipe-box { background: #1a1a1a; padding: 15px; border-radius: 10px; border: 1px solid #d4a373; }
        .ing-row { display: grid; grid-template-columns: 2fr 1fr 40px; gap: 5px; margin-bottom: 5px; }
        .del-row { background: #ff4444; color: #fff; padding: 0; }

        /* Popups */
        .modal { position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: #111; padding: 20px; border-radius: 15px; width: 90%; max-width: 400px; z-index: 1000; box-shadow: 0 0 30px #000; border: 1px solid #d4a373; display: none;}
    </style>
</head>
<body>

    <div class="main-container">
        <h1 id="brand-name">RESTAURANT POS</h1>

        <div class="grid-2">
            <button onclick="switchTab('pos-tab')">Sales</button>
            <button onclick="switchTab('menu-tab')" style="background: #44ff44;">Menu Creator</button>
            <button onclick="switchTab('stock-tab')">Inventory</button>
            <button onclick="logout()">Reset/Login</button>
        </div>

        <div id="pos-tab" class="tab-content active-tab">
            <div class="grid-2">
                <div>
                    <h3 style="text-align:center; color:#d4a373;">Food</h3>
                    <div id="foodGrid" class="category-grid"></div>
                </div>
                <div>
                    <h3 style="text-align:center; color:#1e88e5;">Drinks</h3>
                    <div id="drinkGrid" class="category-grid"></div>
                </div>
            </div>

            <div id="items"></div>
            <div id="total-display">R 0.00</div>
            
            <div class="grid-2">
                <button onclick="openTender()" style="background:#4caf50; height: 80px;">CASH</button>
                <button onclick="processSale('Card')" style="background:#2196f3; height: 80px;">CARD</button>
            </div>
            <button onclick="printTab()" style="background:#666;">PRINT KITCHEN ORDER</button>
        </div>

        <div id="menu-tab" class="tab-content">
            <div class="recipe-box">
                <h2>Create New Item</h2>
                <input type="text" id="m-name" placeholder="Item Name (e.g. Cheese Burger)">
                <input type="number" id="m-price" placeholder="Selling Price">
                <select id="m-cat">
                    <option value="food">Category: Food</option>
                    <option value="drink">Category: Drink</option>
                </select>

                <h4>Ingredients (Manual Entry)</h4>
                <div id="ing-container">
                    <div class="ing-row">
                        <input type="text" class="ing-name" placeholder="Ingredient Name">
                        <input type="number" class="ing-qty" placeholder="Qty">
                        <button class="del-row" onclick="this.parentElement.remove()">X</button>
                    </div>
                </div>
                <button onclick="addRow()" style="background:#555;">+ Add Ingredient</button>
                <button onclick="saveProduct()" style="background:#44ff44; margin-top:15px;">SAVE PRODUCT</button>
            </div>
        </div>

        <div id="stock-tab" class="tab-content">
            <h2>Current Stock Levels</h2>
            <div id="inventory-list"></div>
        </div>
    </div>

    <div id="tender-modal" class="modal">
        <h2>Cash Payment</h2>
        <p>Total Due: <span id="tender-due"></span></p>
        <input type="number" id="cash-given" placeholder="Amount Received" autofocus>
        <button onclick="confirmCash()">Confirm Sale</button>
        <button onclick="closeModal()" style="background:#555;">Cancel</button>
    </div>

    <script>
        // DATA STRUCTURE
        let inventory = JSON.parse(localStorage.getItem('uni_inventory')) || {};
        let recipes = JSON.parse(localStorage.getItem('uni_recipes')) || {};
        let cart = [];

        function saveAll() {
            localStorage.setItem('uni_inventory', JSON.stringify(inventory));
            localStorage.setItem('uni_recipes', JSON.stringify(recipes));
        }

        function switchTab(tabId) {
            document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active-tab'));
            document.getElementById(tabId).classList.add('active-tab');
            if(tabId === 'pos-tab') renderGrids();
            if(tabId === 'stock-tab') renderInventory();
        }

        // MENU CREATOR LOGIC
        function addRow() {
            const div = document.createElement('div');
            div.className = 'ing-row';
            div.innerHTML = `<input type="text" class="ing-name" placeholder="Ingredient Name"><input type="number" class="ing-qty" placeholder="Qty"><button class="del-row" onclick="this.parentElement.remove()">X</button>`;
            document.getElementById('ing-container').appendChild(div);
        }

        function saveProduct() {
            const name = document.getElementById('m-name').value.trim().toUpperCase();
            const price = parseFloat(document.getElementById('m-price').value);
            const cat = document.getElementById('m-cat').value;
            const code = "P_" + Date.now();

            if(!name || isNaN(price)) return alert("Enter Name and Price");

            let recipeObj = {};
            const names = document.querySelectorAll('.ing-name');
            const qtys = document.querySelectorAll('.ing-qty');

            names.forEach((n, i) => {
                const iName = n.value.trim().toUpperCase();
                const iQty = parseFloat(qtys[i].value);
                if(iName && iQty) {
                    recipeObj[iName] = iQty;
                    // Auto-create ingredient in inventory if it doesn't exist
                    if(!inventory[iName]) {
                        inventory[iName] = { name: iName, stock: 0, category: 'ingredient' };
                    }
                }
            });

            inventory[code] = { name, price, category: cat, stock: 999 }; // Main items have "infinite" stock if they are made of ingredients
            if(Object.keys(recipeObj).length > 0) recipes[code] = recipeObj;

            saveAll();
            alert("Product Saved!");
            location.reload();
        }

        // POS LOGIC
        function renderGrids() {
            const fGrid = document.getElementById('foodGrid');
            const dGrid = document.getElementById('drinkGrid');
            fGrid.innerHTML = ''; dGrid.innerHTML = '';

            Object.keys(inventory).forEach(code => {
                const item = inventory[code];
                if(item.category === 'ingredient') return;

                const btn = document.createElement('div');
                btn.className = `product-btn ${item.category}-btn`;
                btn.innerHTML = `
                    <div class="btn-del-x" onclick="deleteProduct(event, '${code}')">X</div>
                    <div onclick="addToCart('${code}')">
                        <b>${item.name}</b><br><span class="price-tag">R${item.price.toFixed(2)}</span>
                    </div>
                `;
                if(item.category === 'food') fGrid.appendChild(btn);
                else dGrid.appendChild(btn);
            });
        }

        function deleteProduct(e, code) {
            e.stopPropagation();
            if(confirm("Delete this button forever?")) {
                delete inventory[code];
                delete recipes[code];
                saveAll();
                renderGrids();
            }
        }

        function addToCart(code) {
            const item = inventory[code];
            cart.push({...item, code});
            updateCartUI();
        }

        function removeFromCart(index) {
            cart.splice(index, 1);
            updateCartUI();
        }

        function updateCartUI() {
            const container = document.getElementById('items');
            container.innerHTML = '';
            let total = 0;
            cart.forEach((item, i) => {
                total += item.price;
                container.innerHTML += `<div class="cart-item"><span>${item.name}</span> <span>R${item.price.toFixed(2)} <button onclick="removeFromCart(${i})" style="width:30px; background:red; color:white; padding:2px;">X</button></span></div>`;
            });
            document.getElementById('total-display').textContent = `R ${total.toFixed(2)}`;
        }

        // SALES & STOCK DEDUCTION
        function processSale(method, cashPaid = 0) {
            if(cart.length === 0) return;

            cart.forEach(item => {
                const recipe = recipes[item.code];
                if(recipe) {
                    for(let ing in recipe) {
                        if(inventory[ing]) inventory[ing].stock -= recipe[ing];
                    }
                } else {
                    inventory[item.code].stock--;
                }
            });

            saveAll();
            printReceipt(method, cashPaid);
            cart = [];
            updateCartUI();
            closeModal();
        }

        // PRINTING
        function printReceipt(method, paid) {
            const total = cart.reduce((s, i) => s + i.price, 0);
            let content = `RECEIPT\n----------------\n`;
            cart.forEach(i => content += `${i.name.padEnd(15)} R${i.price}\n`);
            content += `----------------\nTOTAL: R${total.toFixed(2)}\nMETHOD: ${method}\n`;
            if(paid > 0) content += `PAID: R${paid}\nCHANGE: R${(paid - total).toFixed(2)}\n`;
            
            const win = window.open('', '', 'width=400,height=600');
            win.document.write(`<pre style="font-family:monospace; font-size:14pt;">${content}</pre>`);
            win.document.close();
            win.print();
        }

        function printTab() {
            let content = `KITCHEN ORDER\n----------------\n`;
            cart.forEach(i => content += `[ ] ${i.name}\n`);
            const win = window.open('', '', 'width=400,height=400');
            win.document.write(`<pre style="font-family:monospace; font-size:20pt; font-weight:bold;">${content}</pre>`);
            win.document.close();
            win.print();
        }

        // TENDER POPUP
        function openTender() {
            const total = cart.reduce((s, i) => s + i.price, 0);
            if(total === 0) return;
            document.getElementById('tender-due').textContent = "R" + total.toFixed(2);
            document.getElementById('tender-modal').style.display = 'block';
        }

        function confirmCash() {
            const paid = parseFloat(document.getElementById('cash-given').value);
            processSale('Cash', paid);
        }

        function closeModal() { document.getElementById('tender-modal').style.display = 'none'; }

        function renderInventory() {
            const cont = document.getElementById('inventory-list');
            cont.innerHTML = '';
            Object.values(inventory).forEach(item => {
                cont.innerHTML += `<div style="padding:10px; border-bottom:1px solid #333;">${item.name}: <b>${item.stock}</b> in stock (${item.category})</div>`;
            });
        }

        function logout() { if(confirm("Clear all data and start fresh?")) { localStorage.clear(); location.reload(); } }

        window.onload = renderGrids;
    </script>
</body>
</html>
