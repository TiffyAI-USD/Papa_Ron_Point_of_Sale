<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>PAPA RON'S PREMIUM POS</title>
    <style>
        :root {
            --primary: #d4a373;
            --bg: #000000;
            --surface: #121212;
            --surface-light: #1e1e1e;
            --accent: #44ff44;
            --danger: #ff4444;
            --warning: #ff9800;
            --gold-grad: linear-gradient(145deg, #d4a373, #b38b59, #8a6d4b);
        }
        body { font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; background: var(--bg); color: #fff; margin: 0; padding: 8px; overflow-x: hidden; }
        #banner { width: 100%; box-sizing: border-box; display: flex; justify-content: space-between; align-items: center; padding-bottom: 10px; }
        #login-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: var(--bg); z-index: 9999; display: flex; flex-direction: column; align-items: center; justify-content: center; }
        .login-box { background: var(--surface); padding: 30px; border-radius: 15px; border: 2px solid var(--primary); width: 85%; max-width: 320px; text-align: center; }
        .pin-display { font-size: 2.5rem; letter-spacing: 12px; margin-bottom: 25px; color: var(--primary); font-weight: 900; background: #000; padding: 10px; border-radius: 8px; min-height: 50px; }
        h1 { text-align: center; color: var(--primary); font-size: 1.4rem; letter-spacing: 2px; text-transform: uppercase; margin: 10px 0; font-weight: 900; }
        h3 { color: var(--primary); margin: 0; font-weight: 800; text-transform: uppercase; font-size: 0.9rem; }
        input, button, select { font-size: 0.9rem; padding: 12px; margin: 4px 0; width: 100%; border-radius: 6px; box-sizing: border-box; border: 1px solid #333; font-weight: 800; }
        button { background: var(--gold-grad) !important; color: #000 !important; border: none !important; cursor: pointer; text-transform: uppercase; font-weight: 900; }
        button:active { transform: scale(0.96); opacity: 0.8; }
        .grid-main { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; }
        .tab-content { display: none; margin-top: 10px; animation: fadeIn 0.3s ease; }
        .active-tab { display: block; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        .category-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(90px, 1fr)); gap: 6px; background: var(--surface); padding: 8px; border-radius: 10px; border: 1px solid #222; }
        .product-btn { position: relative; min-height: 65px; font-size: 0.75rem; color: #000 !important; display: flex; align-items: center; justify-content: center; text-align: center; border-radius: 6px; font-weight: 900; padding: 4px; cursor: pointer; text-transform: uppercase; background: var(--gold-grad); border-bottom: 3px solid #8a6d4b; }
        #trans-tabs { display: flex; gap: 4px; overflow-x: auto; padding: 4px 0; }
        .tab-btn { width: auto; padding: 8px 16px; background: #222 !important; color: #777 !important; white-space: nowrap; border: 1px solid #333 !important; font-size: 0.8rem; }
        .tab-btn.active { background: var(--gold-grad) !important; color: #000 !important; border-color: #fff !important; }
        #cart-list { background: var(--surface); border-radius: 8px; padding: 8px; margin: 8px 0; max-height: 150px; overflow-y: auto; border: 1px solid #222; }
        .cart-row { display: flex; justify-content: space-between; border-bottom: 1px solid #222; padding: 6px 0; align-items: center; font-size: 0.85rem; font-weight: 700; }
        #total-view { font-size: 2.5rem; color: var(--accent); text-align: center; margin: 5px 0; font-family: monospace; font-weight: 900; }
        .stock-row { display: grid; grid-template-columns: 35px 1.5fr 0.8fr 0.8fr 100px; align-items: center; background: var(--surface); margin-bottom: 4px; padding: 6px; border-radius: 6px; gap: 4px; border: 1px solid #222; font-size: 0.8rem; text-align: center; font-weight: 700; }
        .modal { position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: #111; padding: 20px; border-radius: 12px; width: 85%; max-width: 350px; z-index: 1000; border: 2px solid var(--primary); display: none; }
        .stock-footer { background: var(--surface-light); padding: 12px; border-radius: 8px; margin-top: 10px; border: 1px dashed var(--primary); text-align: center; font-weight: 800; line-height: 1.6; }
        .btn-small { padding: 6px; font-size: 0.7rem; border-radius: 4px; width: auto; }
        .distro-box { background: var(--surface-light); border: 2px solid var(--warning); padding: 15px; border-radius: 10px; margin-top: 15px; }
        .ing-grid { display: grid; grid-template-columns: 1.5fr 0.8fr 0.8fr; gap: 4px; margin-bottom: 4px; }
    </style>
</head>
<body>
    <div id="login-overlay">
        <div class="login-box">
            <h1>STAFF LOGIN</h1>
            <div id="pin-screen" class="pin-display">****</div>
            <div class="grid-main" style="grid-template-columns: 1fr 1fr 1fr;">
                <button onclick="pP(1)">1</button><button onclick="pP(2)">2</button><button onclick="pP(3)">3</button>
                <button onclick="pP(4)">4</button><button onclick="pP(5)">5</button><button onclick="pP(6)">6</button>
                <button onclick="pP(7)">7</button><button onclick="pP(8)">8</button><button onclick="pP(9)">9</button>
                <button onclick="cP()" style="background:var(--danger)!important; color:#fff!important;">C</button>
                <button onclick="pP(0)">0</button>
                <button onclick="login()" style="background:var(--accent)!important;">OK</button>
            </div>
        </div>
    </div>
    <div id="app-body" style="display:none;">
        <div id="banner">
            <h1 style="margin: 0;">Papa Ron's</h1>
            <div style="display: flex; gap: 5px;">
                <button onclick="printUserSales()" style="width: auto; padding: 5px 10px; font-size: 0.7rem;">CASH UP</button>
                <button onclick="logout()" style="width: auto; padding: 5px 10px; background: #333!important; color: #fff!important;">LOCK</button>
            </div>
        </div>
        <p id="staff-tag" style="text-align:center; color: var(--primary); font-weight: 900; margin: 5px 0;"></p>
        <div class="grid-main">
            <button onclick="switchTab('pos-tab')">Sales</button>
            <button onclick="switchTab('menu-tab')">Builder</button>
            <button onclick="switchTab('stock-tab')">Stock</button>
            <button onclick="switchTab('report-tab')">Reports</button>
        </div>
        <div id="pos-tab" class="tab-content active-tab">
            <div id="trans-tabs"></div>
            <button onclick="createNewTransaction()" style="padding: 10px; margin-bottom: 5px; font-size: 1rem;">+ NEW TABLE</button>
            <div class="grid-main">
                <div class="category-grid" id="foodGrid"></div>
                <div class="category-grid" id="drinkGrid"></div>
            </div>
            <div id="cart-list"></div>
            <div id="total-view">R 0.00</div>
            <div class="grid-main">
                <button onclick="openTender()" style="height:60px; font-size: 1.2rem;">CASH</button>
                <button onclick="finalizeSale('Card')" style="height:60px; font-size: 1.2rem;">CARD</button>
                <button onclick="printKitchenSlip()">Kitchen Slip</button>
                <button onclick="markAsWastage()" style="background:transparent !important; border:1px solid var(--warning) !important; color:var(--warning) !important;">Record Wastage</button>
                <button onclick="adminVoid()" style="background:transparent !important; border:1px solid var(--danger) !important; color:var(--danger) !important;">Void Table</button>
            </div>
        </div>
        <div id="menu-tab" class="tab-content">
            <div style="background:var(--surface); padding:15px; border-radius:10px;">
                <h3>Product Builder</h3>
                <input type="text" id="m-name" placeholder="ITEM NAME">
                <div class="grid-main"><input type="number" id="m-price" placeholder="Sell Price (R)"><input type="number" id="m-cost" placeholder="Item Direct Cost (R)"></div>
                <select id="m-cat"><option value="food">Food Item</option><option value="drink">Drink Item</option></select>
                <p style="font-size: 0.7rem; color: var(--primary); margin: 10px 0 5px 0;">INGREDIENTS (NAME | QTY | UNIT COST)</p>
                <div id="ing-rows"><div class="ing-grid"><input type="text" class="i-name" placeholder="Ingredient"><input type="number" class="i-qty" placeholder="Qty"><input type="number" class="i-cost" placeholder="Cost"></div></div>
                <button onclick="addIngRow()" class="btn-small" style="margin: 10px 0;">+ Add Ingredient</button>
                <button onclick="saveNewProduct()" style="margin-top:10px; font-size: 1rem;">SAVE PRODUCT</button>
            </div>
        </div>
        <div id="stock-tab" class="tab-content">
            <div style="background:var(--surface); padding:8px; border-radius:10px; margin-bottom:10px;">
                <div style="display:flex; gap:8px;"><button onclick="printSelectedStock()">Print Order List</button><button onclick="selectAll(true)" class="btn-small">Select All</button><button onclick="selectAll(false)" class="btn-small">None</button></div>
                <button onclick="printFullValuationReport()" style="margin-top:8px;">Print Valuation PDF</button>
            </div>
            <div id="inventory-display"></div>
            <div class="stock-footer" id="stock-summary"></div>
            <div class="distro-box"><h3>Stock Distribution</h3><input type="text" id="distro-to" placeholder="DESTINATION BRANCH"><input type="number" id="distro-amt" placeholder="QTY TO SEND"><button onclick="processDistro()" style="margin-top:5px;">Process Transfer</button></div>
        </div>
        <div id="report-tab" class="tab-content">
            <div style="background:var(--surface); padding:15px; border-radius:10px;"><h3>Reports</h3>
                <button onclick="generateReport('daily')">Daily Report</button>
                <button onclick="generateReport('weekly')">Weekly Report</button>
                <button onclick="generateReport('monthly')">Monthly Report</button>
            </div>
        </div>
    </div>
    <div id="stock-modal" class="modal"><h2 id="stock-item-name" style="color:var(--primary); text-align:center;"></h2><input type="number" id="stock-add-amt" placeholder="Amount to Add"><button onclick="confirmStockAdd()">Add to Stock</button><button onclick="closeModal()" style="margin-top:8px;">Cancel</button></div>
    <div id="tender-modal" class="modal"><h1 id="cash-total-needed" style="text-align:center; color:var(--accent);"></h1><input type="number" id="cash-amt" placeholder="Amount Received" oninput="calculateChange()"><h2 id="change-due" style="text-align:center;">Change: R0.00</h2><button onclick="finalizeSale('Cash')" style="height: 50px;">COMPLETE SALE</button><button onclick="closeModal()" style="margin-top:8px;">Back</button></div>

    <script>
        // Data Initialization
        let pinStr = "", currentUser = "", currentTransIdx = -1, selectedStockKey = "";
        const ADMIN_PIN = "1010";
        const STAFF_PINS = {"1010": "Sean", "2222": "Momo", "3333": "Beranise", "4444": "Hans", "5555": "Don"};
        let inventory = JSON.parse(localStorage.getItem('pos_inv')) || {};
        let recipes = JSON.parse(localStorage.getItem('pos_rec')) || {};
        let transactions = JSON.parse(localStorage.getItem('pos_trans')) || [];

        // Core Functions
        function pP(n) { if(pinStr.length < 4) { pinStr += n; document.getElementById('pin-screen').textContent = "*".repeat(pinStr.length); } }
        function cP() { pinStr = ""; document.getElementById('pin-screen').textContent = "****"; }
        function logout() { location.reload(); }
        function login() { 
            if(STAFF_PINS[pinStr]) { 
                currentUser = STAFF_PINS[pinStr]; 
                document.getElementById('login-overlay').style.display='none'; 
                document.getElementById('app-body').style.display='block'; 
                document.getElementById('staff-tag').textContent = "LOGGED IN: " + currentUser.toUpperCase();
                startApp(); 
            } else { alert("WRONG PIN"); cP(); } 
        }

        function startApp() {
            if (transactions.filter(t => t.status === 'active').length === 0) createNewTransaction();
            currentTransIdx = transactions.findIndex(t => t.status === 'active');
            renderPOS(); renderStock();
        }

        function save() {
            localStorage.setItem('pos_inv', JSON.stringify(inventory));
            localStorage.setItem('pos_rec', JSON.stringify(recipes));
            localStorage.setItem('pos_trans', JSON.stringify(transactions));
            updateValuation();
        }

        // Transactions & Sales
        function finalizeSale(method) {
            const t = transactions[currentTransIdx]; if (!t || t.items.length === 0) return;
            t.total = t.items.reduce((s, i) => s + i.price, 0); 
            t.method = method; t.status = 'paid'; t.staff = currentUser; t.date = Date.now();
            if(method === 'Card') { 
                const totalCharged = parseFloat(prompt("Enter Total Amount (incl. Tip):")) || t.total;
                t.tip = totalCharged - t.total;
            } else { t.tip = 0; }
            t.items.forEach(it => { if(inventory[it.code]) inventory[it.code].stock--; });
            save(); createNewTransaction(); closeModal(); alert("Sale Successful");
        }

        function markAsWastage() {
            if(prompt("ADMIN PIN:") !== ADMIN_PIN) return alert("UNAUTHORIZED");
            const t = transactions[currentTransIdx]; if(!t || t.items.length === 0) return;
            t.status = 'paid'; t.method = 'Wastage'; t.staff = currentUser;
            t.items.forEach(it => { if(inventory[it.code]) inventory[it.code].stock--; });
            save(); createNewTransaction(); alert("Wastage Logged");
        }

        function adminVoid() {
            if(prompt("ADMIN PIN:") !== ADMIN_PIN) return alert("UNAUTHORIZED");
            transactions[currentTransIdx].status = 'voided';
            save(); startApp(); alert("Voided");
        }

        function confirmStockAdd() {
            if(prompt("ADMIN PIN:") !== ADMIN_PIN) return alert("UNAUTHORIZED");
            inventory[selectedStockKey].stock += parseFloat(document.getElementById('stock-add-amt').value);
            save(); renderStock(); closeModal();
        }

        // Reporting & Printing
        function printUserSales() {
            const userSales = transactions.filter(t => t.status === 'paid' && t.staff === currentUser);
            const cash = userSales.filter(s => s.method === 'Cash').reduce((s, t) => s + t.total, 0);
            const card = userSales.filter(s => s.method === 'Card').reduce((s, t) => s + t.total, 0);
            const tips = userSales.reduce((s, t) => s + (t.tip || 0), 0);
            alert(`--- CASH UP ---\nCASH: R${cash.toFixed(2)}\nCARD: R${card.toFixed(2)}\nTIPS: R${tips.toFixed(2)}\nTOTAL: R${(cash+card+tips).toFixed(2)}`);
        }

        function generateReport(range) {
            if(prompt("ADMIN PIN:") !== ADMIN_PIN) return;
            const now = Date.now();
            const filtered = transactions.filter(t => t.status === 'paid' && (now - t.date < (range === 'daily' ? 86400000 : range === 'weekly' ? 604800000 : 2592000000)));
            let total = filtered.reduce((s, t) => s + t.total, 0);
            alert(`${range.toUpperCase()} SALES: R${total.toFixed(2)}`);
        }

        function printKitchenSlip() {
            const t = transactions[currentTransIdx]; if(!t) return;
            const win = window.open('', '', 'width=300,height=400');
            win.document.write(`<pre>KITCHEN ORDER\nTable: ${t.id}\n${t.items.map(i=>i.name).join('\n')}</pre>`);
            win.document.close(); win.print();
        }

        function printFullValuationReport() {
            if(prompt("ADMIN PIN:") !== ADMIN_PIN) return;
            const win = window.open('', '', 'width=600,height=800');
            win.document.write(`<html><body><h1>VALUATION</h1><pre>${JSON.stringify(inventory, null, 2)}</pre></body></html>`);
            win.document.close(); win.print();
        }

        function printSelectedStock() {
            const list = Array.from(document.querySelectorAll('.stock-check:checked')).map(c => inventory[c.value].name).join('\n');
            const win = window.open('', '', 'width=300,height=400');
            win.document.write(`<pre>ORDER LIST\n${list}</pre>`);
            win.document.close(); win.print();
        }

        function processDistro() {
            if(prompt("ADMIN PIN:") !== ADMIN_PIN) return;
            const qty = parseFloat(document.getElementById('distro-amt').value);
            document.querySelectorAll('.stock-check:checked').forEach(c => inventory[c.value].stock -= qty);
            save(); renderStock(); alert("Transferred");
        }

        // UI Helpers
        function switchTab(id) {
            document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active-tab'));
            document.getElementById(id).classList.add('active-tab');
        }
        function renderPOS() {
            const f = document.getElementById('foodGrid'), d = document.getElementById('drinkGrid');
            f.innerHTML=''; d.innerHTML='';
            Object.keys(inventory).forEach(k => {
                if(inventory[k].category === 'ingredient') return;
                const btn = document.createElement('div'); btn.className = 'product-btn';
                btn.innerHTML = `<div onclick="addToCart('${k}')"><b>${inventory[k].name}</b><br>R${inventory[k].price.toFixed(2)}</div>`;
                inventory[k].category === 'food' ? f.appendChild(btn) : d.appendChild(btn);
            });
            updateCartUI();
        }
        function renderStock() {
            const cont = document.getElementById('inventory-display'); cont.innerHTML = '';
            Object.keys(inventory).forEach(k => {
                cont.innerHTML += `<div class="stock-row"><input type="checkbox" class="stock-check" value="${k}"><div>${inventory[k].name}</div><div>${inventory[k].stock}</div><div>R${(inventory[k].price-inventory[k].cost||0).toFixed(2)}</div><button onclick="openStockIn('${k}')" class="btn-small">+In</button></div>`;
            });
            updateValuation();
        }
        function updateValuation() {
            const total = Object.values(inventory).reduce((s, i) => s + (i.stock * i.cost), 0);
            document.getElementById('stock-summary').textContent = `Total Inventory Cost: R${total.toFixed(2)}`;
        }
        function addToCart(k) { transactions[currentTransIdx].items.push({...inventory[k], code: k}); updateCartUI(); }
        function removeFromCart(i) { transactions[currentTransIdx].items.splice(i, 1); updateCartUI(); }
        function updateCartUI() {
            const list = document.getElementById('cart-list'); list.innerHTML = ''; let total = 0;
            transactions[currentTransIdx].items.forEach((it, i) => { total += it.price; list.innerHTML += `<div class="cart-row"><span>${it.name}</span><button onclick="removeFromCart(${i})">Ã—</button></div>`; });
            document.getElementById('total-view').textContent = `R ${total.toFixed(2)}`;
        }
        function createNewTransaction() { transactions.push({id: transactions.length + 1, items: [], status:'active', date: Date.now()}); currentTransIdx = transactions.length - 1; renderPOS(); }
        function openTender() { document.getElementById('tender-modal').style.display='block'; }
        function calculateChange() { const cash = parseFloat(document.getElementById('cash-amt').value)||0; const total = transactions[currentTransIdx].items.reduce((s,i)=>s+i.price,0); document.getElementById('change-due').textContent = `Change: R${(cash-total).toFixed(2)}`; }
        function addIngRow() { const d = document.createElement('div'); d.className="ing-grid"; d.innerHTML=`<input type="text" class="i-name"><input type="number" class="i-qty"><input type="number" class="i-cost">`; document.getElementById('ing-rows').appendChild(d); }
        function saveNewProduct() { inventory["P_"+Date.now()] = { name: document.getElementById('m-name').value.toUpperCase(), price: parseFloat(document.getElementById('m-price').value), cost: parseFloat(document.getElementById('m-cost').value), stock: 0, category: document.getElementById('m-cat').value }; save(); location.reload(); }
        function closeModal() { document.querySelectorAll('.modal').forEach(m => m.style.display='none'); }
        function selectAll(v) { document.querySelectorAll('.stock-check').forEach(c => c.checked = v); }
    </script>
</body>
</html>
